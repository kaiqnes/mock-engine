const express = require('express')
const app = express()

app.use(express.json())

const getOperation = (input) => {
  if (input.includes('1234567890')) {
    return 'boleto'
  } else if (input.toLowerCase() === 'oi') {
    return 'boas vindas'
  }
  return input.toLowerCase()
}

app.use((req, res, next) => {
  console.log(`OPERATION: ${getOperation(req.body.input)}`)
  return next()
})

// /* SIM */const TRANSACIONAL_AUTENTICACAO_2 = {"dialogResponses":[],"intents":[{"name":"DECISION_INT_SIM","confidence":.888968},{"name":"PEDIDO_DESISTIR","confidence":.162854478},{"name":"01_GREETING","confidence":.123502061},{"name":"01_MAQUINA_DESAMBIGUACAO","confidence":.0334910527},{"name":"01_INSULT","confidence":.0331230275},{"name":"05_BOA_NOITE","confidence":.02708885},{"name":"NUMBERS_INT","confidence":.0253758859},{"name":"PEDIDO_COMPRA_FINALIZADA","confidence":.0214992817},{"name":"DECISION_INT_NAO","confidence":.0195740685},{"name":"02_DESPEDIDA","confidence":.01845371},{"name":"03_BOM_DIA","confidence":.0180722158},{"name":"PEDIDO_AJUDA_01","confidence":.0157685876},{"name":"07_PRODUTO_DESAMBIGUACAO","confidence":.0150837889},{"name":"PEDIDO_PEDIR_AJUDA","confidence":.0112917423},{"name":"CRIAR_PEDIDO","confidence":.0112509709},{"name":"04_MAQUINA_RECOLHA","confidence":.01017982},{"name":"04_BOA_TARDE","confidence":.0101586292},{"name":"PEDIDO","confidence":.009989601},{"name":"09_PRODUTOS_PORTFOLIO","confidence":.008528268},{"name":"03_ASSISTENCIA_CONSERTO","confidence":.0075785825},{"name":"07_BOLETO_NEGOCIACAO","confidence":.006360449},{"name":"02_MENU","confidence":.00617742352},{"name":"01_ASSISTENCIA_CONTATO","confidence":.00607003365},{"name":"08_PRODUTOS_PROBLEMAS","confidence":.005231973},{"name":"02_MAQUINA_TROCA_CONDENADA","confidence":.005063243},{"name":"01_SEGVIA_BOLETO","confidence":.00495431153},{"name":"05_PRODUTOS_PROMOCOES_KIBON","confidence":.004720684},{"name":"04_PEDIDO_TROCA_DEVOLUCAO","confidence":.004550093},{"name":"01_PAGAMENTO_CARTAO","confidence":.004076573},{"name":"03_MAQUINA_INDENIZACAO","confidence":.003736709},{"name":"04_BOLETO_PRORROGACAO","confidence":.00364443148},{"name":"01_CADASTRO_TAXA","confidence":.00345168635},{"name":"02_GERAL_COMPRA_FREEZER","confidence":.00343307876},{"name":"08_PEDIDO_FRETE","confidence":.00327415043},{"name":"01_PRODUTOS_REUTILIZACAO","confidence":.003233667},{"name":"01_GERAL_PRODUTOS","confidence":.00316682318},{"name":"02_CADASTRO_RESET_SENHA","confidence":.00302493083},{"name":"02_PAGAMENTO_DIVERGENCIA","confidence":.002612116},{"name":"06_PEDIDO_AGENDAMENTO","confidence":.002426017},{"name":"04_ASSISTENCIA_CONSUMO","confidence":.00239783083},{"name":"02_ASSISTENCIA_LIMPEZA","confidence":.00215720013},{"name":"02_PEDIDO_VALOR","confidence":.00205307524},{"name":"08_BOLETO_DUPLICIDADE","confidence":.00169689057},{"name":"07_PEDIDO_ENTREGA_HORARIO","confidence":.00151382829},{"name":"03_BOLETO_PROBLEMA","confidence":.00129887916},{"name":"02_PRODUTOS_FREEZER_PROPRIO","confidence":.001253237},{"name":"05_BOLETO_FATURAMENTO_ACORDO","confidence":.001223029},{"name":"06_BOLETO_COMPROVANTE","confidence":9.349562E-4},{"name":"10_BOLETO_CONSULTA_DEPOSITOS","confidence":6.922349E-4},{"name":"01_NOTAS_CONSULTAS","confidence":6.595073E-4},{"name":"03_PEDIDO_COMPRA","confidence":5.32256847E-4},{"name":"None","confidence":4.05141735E-4},{"name":"09_BOLETO_SERASA","confidence":3.79000849E-4},{"name":"01_PEDIDO_SEM_BOLETO","confidence":3.3860642E-4},{"name":"01_ARMAZENAMENTO","confidence":3.21349216E-4},{"name":"04_PRODUTOS_PRAZO_VALIDADE","confidence":2.28505727E-4},{"name":"06_PRODUTOS_TROCA_ENDERECO_PEDIDO","confidence":1.82668824E-4},{"name":"11_BOLETO_NOTAS_ABERTAS","confidence":1.484978E-4},{"name":"05_PEDIDO_ENTREGA","confidence":8.73803947E-5},{"name":"12_BOLETO_SEM_MERCADORIA","confidence":8.445195E-5},{"name":"03_PRODUTOS_FREEZER_OUTROS_PRODUTOS","confidence":8.222512E-5},{"name":"STATUS_DO_PEDIDO","confidence":6.91924361E-5}],"entities":[],"context":null}


// Mock do motor cognitivo (Substituição ao LUIS)
app.post('/conversations', (req, res) => {
  const { input } = req.body
  const parsedInput = parseInt(input)
  let response;

  if (input !== undefined) {
    // if (!isNaN(parsedInput) && input.length == 14) {
    if ((!isNaN(parsedInput) && input.length == 14) || input.includes(".") && input.includes("/") && input.includes("-") && input.length == 18) {
      response = { "dialogResponses": [], "intents": [{ "name": "TRANSACIONAL_AUTENTICACAO", "confidence": .8154406 }, { "name": "01_GREETING", "confidence": .4183725 }, { "name": "PEDIDO_DESISTIR", "confidence": .162284791 }, { "name": "02_DESPEDIDA", "confidence": .150015339 }, { "name": "01_INSULT", "confidence": .04771529 }, { "name": "04_MAQUINA_RECOLHA", "confidence": .0440973938 }, { "name": "PEDIDO_COMPRA_FINALIZADA", "confidence": .043919798 }, { "name": "03_MAQUINA_INDENIZACAO", "confidence": .0368034542 }, { "name": "07_BOLETO_NEGOCIACAO", "confidence": .0247538351 }, { "name": "DECISION_INT_NAO", "confidence": .0224794578 }, { "name": "DECISION_INT_SIM", "confidence": .0148021178 }, { "name": "03_BOM_DIA", "confidence": .0129162893 }, { "name": "NUMBERS_INT", "confidence": .0122866919 }, { "name": "PEDIDO_AJUDA_01", "confidence": .0113888271 }, { "name": "07_PRODUTO_DESAMBIGUACAO", "confidence": .0107228179 }, { "name": "05_BOA_NOITE", "confidence": .009581779 }, { "name": "04_BOLETO_PRORROGACAO", "confidence": .00508550648 }, { "name": "02_MAQUINA_TROCA_CONDENADA", "confidence": .004796172 }, { "name": "PEDIDO_PEDIR_AJUDA", "confidence": .00449290266 }, { "name": "PEDIDO", "confidence": .0041804756 }, { "name": "01_MAQUINA_DESAMBIGUACAO", "confidence": .00403842749 }, { "name": "04_BOA_TARDE", "confidence": .004012304 }, { "name": "09_PRODUTOS_PORTFOLIO", "confidence": .00376864616 }, { "name": "CRIAR_PEDIDO", "confidence": .003187059 }, { "name": "01_CADASTRO_TAXA", "confidence": .0030761743 }, { "name": "08_PRODUTOS_PROBLEMAS", "confidence": .00286445487 }, { "name": "08_BOLETO_DUPLICIDADE", "confidence": .002788563 }, { "name": "02_PAGAMENTO_DIVERGENCIA", "confidence": .00223038229 }, { "name": "06_PEDIDO_AGENDAMENTO", "confidence": .00215388322 }, { "name": "05_PRODUTOS_PROMOCOES_KIBON", "confidence": .00211844384 }, { "name": "03_ASSISTENCIA_CONSERTO", "confidence": .00187873631 }, { "name": "01_PRODUTOS_REUTILIZACAO", "confidence": .00180351979 }, { "name": "02_CADASTRO_RESET_SENHA", "confidence": .0017243115 }, { "name": "02_GERAL_COMPRA_FREEZER", "confidence": .00168784359 }, { "name": "08_PEDIDO_FRETE", "confidence": .00166968768 }, { "name": "01_GERAL_PRODUTOS", "confidence": .00160648872 }, { "name": "04_PEDIDO_TROCA_DEVOLUCAO", "confidence": .00157093653 }, { "name": "01_ASSISTENCIA_CONTATO", "confidence": .0015639289 }, { "name": "04_ASSISTENCIA_CONSUMO", "confidence": .00139887712 }, { "name": "02_PRODUTOS_FREEZER_PROPRIO", "confidence": .00131030916 }, { "name": "05_BOLETO_FATURAMENTO_ACORDO", "confidence": .00118367421 }, { "name": "01_PAGAMENTO_CARTAO", "confidence": .00113511737 }, { "name": "07_PEDIDO_ENTREGA_HORARIO", "confidence": .00104767911 }, { "name": "01_SEGVIA_BOLETO", "confidence": 8.167808E-4 }, { "name": "02_PEDIDO_VALOR", "confidence": 7.75185E-4 }, { "name": "10_BOLETO_CONSULTA_DEPOSITOS", "confidence": 7.105036E-4 }, { "name": "02_ASSISTENCIA_LIMPEZA", "confidence": 6.435967E-4 }, { "name": "03_BOLETO_PROBLEMA", "confidence": 6.366788E-4 }, { "name": "04_PRODUTOS_PRAZO_VALIDADE", "confidence": 5.37405256E-4 }, { "name": "06_BOLETO_COMPROVANTE", "confidence": 4.921402E-4 }, { "name": "09_BOLETO_SERASA", "confidence": 4.32671E-4 }, { "name": "03_PEDIDO_COMPRA", "confidence": 4.29104373E-4 }, { "name": "01_ARMAZENAMENTO", "confidence": 3.08015762E-4 }, { "name": "01_NOTAS_CONSULTAS", "confidence": 2.81661458E-4 }, { "name": "01_PEDIDO_SEM_BOLETO", "confidence": 1.56460243E-4 }, { "name": "06_PRODUTOS_TROCA_ENDERECO_PEDIDO", "confidence": 1.22845348E-4 }, { "name": "11_BOLETO_NOTAS_ABERTAS", "confidence": 1.08167435E-4 }, { "name": "STATUS_DO_PEDIDO", "confidence": 5.13903324E-5 }, { "name": "03_PRODUTOS_FREEZER_OUTROS_PRODUTOS", "confidence": 4.301323E-5 }, { "name": "05_PEDIDO_ENTREGA", "confidence": 3.978385E-5 }, { "name": "12_BOLETO_SEM_MERCADORIA", "confidence": 3.20576473E-5 }], "entities": [{ "name": "builtin.number", "value": "11111111111111", "position": null }, { "name": "VALID CNPJ", "value": input, "position": null }], "context": null }
    } else if (!isNaN(parsedInput) && input.length == 1) {
      response = {"dialogResponses":[],"intents":[{"name":"NUMBERS_INT","confidence":0.9069458},{"name":"PEDIDO_DESISTIR","confidence":0.162854478},{"name":"01_INSULT","confidence":0.151560083},{"name":"DECISION_INT_NAO","confidence":0.0505734533},{"name":"01_MAQUINA_DESAMBIGUACAO","confidence":0.0334910527},{"name":"01_GREETING","confidence":0.0302337985},{"name":"DECISION_INT_SIM","confidence":0.030094238},{"name":"05_BOA_NOITE","confidence":0.02708885},{"name":"PEDIDO_COMPRA_FINALIZADA","confidence":0.0214992817},{"name":"02_DESPEDIDA","confidence":0.01845371},{"name":"03_BOM_DIA","confidence":0.0180722158},{"name":"PEDIDO_AJUDA_01","confidence":0.0157685876},{"name":"PEDIDO_PEDIR_AJUDA","confidence":0.0112917423},{"name":"04_MAQUINA_RECOLHA","confidence":0.01017982},{"name":"04_BOA_TARDE","confidence":0.0101586292},{"name":"PEDIDO","confidence":0.009989601},{"name":"07_PRODUTO_DESAMBIGUACAO","confidence":0.009428047},{"name":"09_PRODUTOS_PORTFOLIO","confidence":0.008528268},{"name":"02_MENU","confidence":0.008492772},{"name":"CRIAR_PEDIDO","confidence":0.007651801},{"name":"03_ASSISTENCIA_CONSERTO","confidence":0.0075785825},{"name":"07_BOLETO_NEGOCIACAO","confidence":0.006360449},{"name":"01_ASSISTENCIA_CONTATO","confidence":0.00607003365},{"name":"08_PRODUTOS_PROBLEMAS","confidence":0.005231973},{"name":"02_MAQUINA_TROCA_CONDENADA","confidence":0.005063243},{"name":"01_SEGVIA_BOLETO","confidence":0.00495431153},{"name":"05_PRODUTOS_PROMOCOES_KIBON","confidence":0.004720684},{"name":"03_MAQUINA_INDENIZACAO","confidence":0.00452497276},{"name":"04_BOLETO_PRORROGACAO","confidence":0.004463452},{"name":"01_PAGAMENTO_CARTAO","confidence":0.004076573},{"name":"01_GERAL_PRODUTOS","confidence":0.00375508331},{"name":"04_PEDIDO_TROCA_DEVOLUCAO","confidence":0.00374103058},{"name":"02_CADASTRO_RESET_SENHA","confidence":0.00354026817},{"name":"01_CADASTRO_TAXA","confidence":0.00345168635},{"name":"02_GERAL_COMPRA_FREEZER","confidence":0.00343307876},{"name":"01_PRODUTOS_REUTILIZACAO","confidence":0.003233667},{"name":"08_PEDIDO_FRETE","confidence":0.00283068349},{"name":"02_PAGAMENTO_DIVERGENCIA","confidence":0.002612116},{"name":"06_PEDIDO_AGENDAMENTO","confidence":0.002426017},{"name":"02_PEDIDO_VALOR","confidence":0.00228646561},{"name":"02_ASSISTENCIA_LIMPEZA","confidence":0.00215720013},{"name":"04_ASSISTENCIA_CONSUMO","confidence":0.00214331923},{"name":"08_BOLETO_DUPLICIDADE","confidence":0.001520033},{"name":"07_PEDIDO_ENTREGA_HORARIO","confidence":0.00140046165},{"name":"03_BOLETO_PROBLEMA","confidence":0.00138893642},{"name":"02_PRODUTOS_FREEZER_PROPRIO","confidence":0.001253237},{"name":"05_BOLETO_FATURAMENTO_ACORDO","confidence":0.001223029},{"name":"06_BOLETO_COMPROVANTE","confidence":9.349562E-4},{"name":"10_BOLETO_CONSULTA_DEPOSITOS","confidence":6.922349E-4},{"name":"01_NOTAS_CONSULTAS","confidence":6.91361434E-4},{"name":"03_PEDIDO_COMPRA","confidence":5.32256847E-4},{"name":"None","confidence":4.05141735E-4},{"name":"09_BOLETO_SERASA","confidence":3.91830283E-4},{"name":"01_PEDIDO_SEM_BOLETO","confidence":3.3860642E-4},{"name":"01_ARMAZENAMENTO","confidence":3.162097E-4},{"name":"04_PRODUTOS_PRAZO_VALIDADE","confidence":2.28505727E-4},{"name":"06_PRODUTOS_TROCA_ENDERECO_PEDIDO","confidence":1.82668824E-4},{"name":"11_BOLETO_NOTAS_ABERTAS","confidence":1.484978E-4},{"name":"05_PEDIDO_ENTREGA","confidence":8.75956539E-5},{"name":"12_BOLETO_SEM_MERCADORIA","confidence":8.445195E-5},{"name":"03_PRODUTOS_FREEZER_OUTROS_PRODUTOS","confidence":8.219611E-5},{"name":"STATUS_DO_PEDIDO","confidence":6.853061E-5}],"entities":[{"name":"builtin.number","value":input,"position":null}],"context":null}
    } else if (!isNaN(parsedInput) && input.length == 6) {
      response = {"dialogResponses":[],"intents":[{"name":"TOKEN_INT","confidence":.7868233},{"name":"01_GREETING","confidence":.58964324},{"name":"PEDIDO_COMPRA_FINALIZADA","confidence":.177793518},{"name":"01_INSULT","confidence":.105108581},{"name":"02_MENU","confidence":.0775383562},{"name":"02_DESPEDIDA","confidence":.0589755},{"name":"03_MAQUINA_INDENIZACAO","confidence":.04616165},{"name":"04_MAQUINA_RECOLHA","confidence":.040543396},{"name":"DECISION_INT_SIM","confidence":.04046262},{"name":"PEDIDO_DESISTIR","confidence":.04002833},{"name":"DECISION_INT_NAO","confidence":.03363574},{"name":"07_BOLETO_NEGOCIACAO","confidence":.0309107956},{"name":"NUMBERS_INT","confidence":.0119399428},{"name":"04_BOA_TARDE","confidence":.0119134691},{"name":"03_BOM_DIA","confidence":.011807722},{"name":"PEDIDO_AJUDA_01","confidence":.0110371718},{"name":"05_BOA_NOITE","confidence":.010060099},{"name":"PEDIDO","confidence":.00999228749},{"name":"02_MAQUINA_TROCA_CONDENADA","confidence":.006019673},{"name":"07_PRODUTO_DESAMBIGUACAO","confidence":.00593576953},{"name":"PEDIDO_PEDIR_AJUDA","confidence":.00539233442},{"name":"01_MAQUINA_DESAMBIGUACAO","confidence":.004455444},{"name":"CRIAR_PEDIDO","confidence":.004275401},{"name":"09_PRODUTOS_PORTFOLIO","confidence":.00400906},{"name":"04_BOLETO_PRORROGACAO","confidence":.00360601279},{"name":"01_GERAL_PRODUTOS","confidence":.003265983},{"name":"05_PRODUTOS_PROMOCOES_KIBON","confidence":.00279316632},{"name":"08_PRODUTOS_PROBLEMAS","confidence":.00270758965},{"name":"01_CADASTRO_TAXA","confidence":.00244887872},{"name":"01_ASSISTENCIA_CONTATO","confidence":.00217072573},{"name":"03_ASSISTENCIA_CONSERTO","confidence":.00215649256},{"name":"02_PAGAMENTO_DIVERGENCIA","confidence":.002120913},{"name":"02_PRODUTOS_FREEZER_PROPRIO","confidence":.00198339974},{"name":"08_BOLETO_DUPLICIDADE","confidence":.00188044459},{"name":"06_PEDIDO_AGENDAMENTO","confidence":.00184964272},{"name":"02_GERAL_COMPRA_FREEZER","confidence":.00182073051},{"name":"07_PEDIDO_ENTREGA_HORARIO","confidence":.00147482834},{"name":"01_PRODUTOS_REUTILIZACAO","confidence":.00136238115},{"name":"01_SEGVIA_BOLETO","confidence":.00134140335},{"name":"02_CADASTRO_RESET_SENHA","confidence":.00130418665},{"name":"04_ASSISTENCIA_CONSUMO","confidence":.00106031552},{"name":"04_PEDIDO_TROCA_DEVOLUCAO","confidence":9.750042E-4},{"name":"05_BOLETO_FATURAMENTO_ACORDO","confidence":9.62002843E-4},{"name":"08_PEDIDO_FRETE","confidence":8.947897E-4},{"name":"10_BOLETO_CONSULTA_DEPOSITOS","confidence":7.947597E-4},{"name":"01_PAGAMENTO_CARTAO","confidence":7.66972254E-4},{"name":"02_PEDIDO_VALOR","confidence":6.036793E-4},{"name":"02_ASSISTENCIA_LIMPEZA","confidence":5.27699944E-4},{"name":"09_BOLETO_SERASA","confidence":4.6056445E-4},{"name":"06_BOLETO_COMPROVANTE","confidence":4.23958147E-4},{"name":"01_NOTAS_CONSULTAS","confidence":3.99659242E-4},{"name":"04_PRODUTOS_PRAZO_VALIDADE","confidence":3.70358146E-4},{"name":"01_ARMAZENAMENTO","confidence":3.55338037E-4},{"name":"03_PEDIDO_COMPRA","confidence":2.32557722E-4},{"name":"11_BOLETO_NOTAS_ABERTAS","confidence":2.05790624E-4},{"name":"03_BOLETO_PROBLEMA","confidence":1.81449286E-4},{"name":"STATUS_DO_PEDIDO","confidence":1.26045386E-4},{"name":"01_PEDIDO_SEM_BOLETO","confidence":1.25021572E-4},{"name":"06_PRODUTOS_TROCA_ENDERECO_PEDIDO","confidence":1.13545677E-4},{"name":"03_PRODUTOS_FREEZER_OUTROS_PRODUTOS","confidence":5.722709E-5},{"name":"05_PEDIDO_ENTREGA","confidence":2.5944244E-5},{"name":"12_BOLETO_SEM_MERCADORIA","confidence":1.99153383E-5}],"entities":[{"name":"builtin.number","value":input,"position":null}],"context":null}
    } else if (input.toLowerCase().includes('autenticacao')) {
      response = { "dialogResponses": [], "entities": [], "intents": [{ "name": "TRANSACIONAL_AUTENTICACAO", "confidence": 1 }] } //BOLETO
    } else if (input.toLowerCase().includes('boleto')) {
      response = { "dialogResponses": [], "entities": [], "intents": [{ "name": "TRANSACIONAL_BOLETO", "confidence": 1 }] } //BOLETO
    } else if (input.toLowerCase().includes('pedido')) {
      response = { "dialogResponses": [], "entities": [], "intents": [{ "name": "TRANSACIONAL_PEDIDO", "confidence": 1 }] } //PEDIDO
    } else if (input.toLowerCase().includes('sim') && false) {
      response = TRANSACIONAL_AUTENTICACAO_2
    } else {
      response = { "dialogResponses": [], "entities": [], "intents": [{ "name": "01_GREETING", "confidence": 1 }] } //BOAS_VINDAS
    }
  }

  if (response === undefined) {
    response = { "dialogResponses": [], "entities": [], "intents": [{ "name": "01_GREETING", "confidence": 1 }] } //BOAS_VINDAS
  }

  res.json(response)
})

app.listen(3334)
